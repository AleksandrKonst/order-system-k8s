# Глобальные настройки
global:
  namespace: order-system
  domain: local
  imageRegistry: docker.io
  
# Vault конфигурация
vault:
  enabled: true
  operator:
    enabled: true
  server:
    dev:
      enabled: true
    service:
      type: ClusterIP
    ingress:
      enabled: true
      className: nginx
      hosts:
        - host: vault.local
          paths:
            - path: /
              pathType: Prefix

# Prometheus мониторинг
monitoring:
  prometheus:
    enabled: true
  grafana:
    enabled: true
    ingress:
      enabled: true
      className: nginx
      hosts:
        - grafana.local
  
  # Настройки для анализа метрик
  analysis:
    successRateThreshold: 0.95
    errorRateThreshold: 0.05
    interval: 30s
    failureLimit: 3

# Argo Rollouts
rollouts:
  enabled: true
  controller:
    metrics:
      enabled: true

# Конфигурация микросервисов
processingOrders:
  enabled: true
  image:
    repository: processing-orders-api
    tag: latest
    pullPolicy: IfNotPresent
  
  replicaCount: 3
  
  service:
    type: ClusterIP
    port: 80
    
  ingress:
    enabled: true
    className: nginx
    host: processing-orders.local
    
  # Vault интеграция
  vault:
    enabled: true
    role: "order-system"
    path: "order-system"
    
  # Канареечный деплой
  rollout:
    enabled: true
    strategy:
      canary:
        steps:
          - setWeight: 20
          - pause: {duration: 30s}
          - setWeight: 50
          - pause: {duration: 30s}
        analysis:
          templates:
            - templateName: success-rate
          args:
            - name: service-name
              value: processing-orders-api

mailings:
  enabled: true
  image:
    repository: mailings-service
    tag: latest
  replicaCount: 2
  vault:
    enabled: true

promotions:
  enabled: true
  image:
    repository: promotions-service
    tag: latest
  replicaCount: 2
  vault:
    enabled: true
  ingress:
    enabled: true
    className: nginx
    host: promotions.local

# Инфраструктура
kafka:
  enabled: true
  persistence:
    enabled: true
    size: 8Gi

postgres:
  enabled: true
  persistence:
    enabled: true
    size: 8Gi
  vault:
    enabled: true